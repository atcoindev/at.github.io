<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>GroundRod PID</title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="Anoncoin(ANC) is a unique decentralized peer to peer internet cryptocurrency that provides for its users. I2P and Tor compatible, it is resistant to crackdowns from hostile authorities.  ">
    <meta name="keywords" content="" /> 
    <link rel="canonical" href="https://anoncoin.net/GroundRod_PID/">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml">

    <!-- Custom CSS & Bootstrap Core CSS - Uses Bootswatch Flatly Theme: http://bootswatch.com/flatly/ -->
    <link rel="stylesheet" href=" /style.css ">

    <!-- Custom Fonts -->
    <link rel="stylesheet" href=" /css/font-awesome/css/font-awesome.min.css ">
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
    <body id="page-top" class="index">
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-dropping">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Anoncoin</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <nav id="navbar-dropping" class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                    
                <li class="dropdown ">
                    <a href="/About_Anoncoin/" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
                        aria-expanded="false">About
                        <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu">
                         
                        <li>
                            <a href="/About_Anoncoin/">About Anoncoin</a>
                        </li>
                          
                        <li>
                            <a href="/Anoncoin_in_the_news/">Anoncoin in the news</a>
                        </li>
                          
                        <li>
                            <a href="/Anoncoin_development_team/">Anoncoin development team</a>
                        </li>
                          
                        <li>
                            <a href="https://github.com/Anoncoin/project/tree/master/roadmap">Roadmap</a>
                        </li>
                          
                        <li>
                            <a href="/Donate/">Donate</a>
                        </li>
                         
                    </ul>
                </li>
                    
                <li class="dropdown ">
                    <a href="/Download/" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
                        aria-expanded="false">Downloads
                        <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu">
                         
                        <li>
                            <a href="/Download/#windowsdownload">Windows</a>
                        </li>
                          
                        <li>
                            <a href="/Download/#macdownload">Mac</a>
                        </li>
                          
                        <li>
                            <a href="/Download/#linuxdownload">Linux</a>
                        </li>
                         
                    </ul>
                </li>
                    
                <li class="dropdown ">
                    <a href="/Blog/" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
                        aria-expanded="false">Resources
                        <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu">
                         
                        <li>
                            <a href="/Blog/">Blog</a>
                        </li>
                          
                        <li>
                            <a href="/FAQ/">FAQ</a>
                        </li>
                          
                        <li>
                            <a href="/Wiki/">Wiki</a>
                        </li>
                          
                        <li>
                            <a href="/How_to_guides/">How to guides</a>
                        </li>
                         
                    </ul>
                </li>
                    
                <li class="dropdown ">
                    <a href="/Exchanges/" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
                        aria-expanded="false">Services
                        <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu">
                         
                        <li>
                            <a href="/Exchanges/">Exchanges</a>
                        </li>
                          
                        <li>
                            <a href="http://anoncash.net">Blockchain explorer</a>
                        </li>
                          
                        <li>
                            <a href="/Mining_pools/">Mining pools</a>
                        </li>
                          
                        <li role="separator" class="divider"></li>
                          
                        <li>
                            <a href="/Places_that_accept_Anoncoin/">Places that accept Anoncoin</a>
                        </li>
                         
                    </ul>
                </li>
                    
                <li class="dropdown ">
                    <a href="/Community/" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
                        aria-expanded="false">Community
                        <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu">
                         
                        <li>
                            <a href="https://join.slack.com/t/anoncoin/shared_invite/enQtMjcxMzUxMjk5ODYwLTU0OTJhNmIxNzYyY2JiMzUxOGZhMjYzNmQ3YmViNWM1OWIxZGNlMGY0Zjg1NzdhMDAyZmRiYTFhNTM1OWZiYTU">Slack</a>
                        </li>
                          
                        <li>
                            <a href="https://bitcointalk.org/index.php?topic=227287.0">Bitcointalk</a>
                        </li>
                          
                        <li>
                            <a href="https://www.reddit.com/r/Anoncoin/">Reddit</a>
                        </li>
                          
                        <li>
                            <a href="https://www.youtube.com/channel/UCwKSmUNcoRrBwm-kdsl1n2w">YouTube</a>
                        </li>
                          
                        <li>
                            <a href="https://twitter.com/anoncoinproject">Official Twitter</a>
                        </li>
                          
                        <li>
                            <a href="https://www.facebook.com/Anoncoin/">Facebook page</a>
                        </li>
                         
                    </ul>
                </li>
                 
            </ul>
        </nav>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container-fluid -->
</nav>
    <!-- About Section -->
<section class="article" id="about"></section>
<div class="container">
    <div class="row">
        <div class="col-lg-12 text-center">
            <h1>GroundRod PID</h1>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-12">
            <p>
    <font color="red"><i>
    This is an old archived article with out of date content.
    </i></font>
    <h2 id="presentation-of-groundrod-pid">Presentation of GroundRod PID</h2>

<p>EDIT2: those settings were changed in the 0.9.6.12 version of Anoncoin at block 585555 due to the not good retargeting of ver1 (see link EDIT1 below). Result of 11000 blocks mined (585555-596555) on mainet after hardfork2 <a href="/GroundRod_PID_main_ver2/" title="wikilink">GroundRod_PID_main_ver2</a></p>

<p>EDIT1: Result (not good) on mainet after 5000 blocks mined (555555-556555) on mainet after hardfork1 <a href="/GroundRod_PID_main_ver1/" title="wikilink">GroundRod_PID_main_ver1</a></p>

<hr />

<p>Here we show the results on testnet of using the GroundRod PID Retarget Difficulty Algo featured in the 0.9.6.11 version of Anoncoin.</p>

<p><a href="https://github.com/Anoncoin/anoncoin/blob/master/src/pow.cpp">https://github.com/Anoncoin/anoncoin/blob/master/src/pow.cpp</a></p>

<p>The PID settings used in this simulation are the one used for the 9.6.11 version ready for hardfork-block 555555.</p>

<p><code></code></p>

<ol>
  <li>define PID_PROPORTIONALGAIN “1.7”</li>
  <li>define PID_INTEGRATORTIME “172800”</li>
  <li>define PID_INTEGRATORGAIN “5”</li>
  <li>define PID_DERIVATIVEGAIN “0”</li>
  <li>define TIPFILTERBLOCKS_DEFAULT “21”</li>
  <li>define USESHEADER_DEFAULT false</li>
  <li>define NMAXDIFFINCREASE “200”</li>
  <li>define NMAXDIFFDECREASE “170”</li>
  <li>define DMININTEGRATOR 170</li>
  <li>define DMAXINTEGRATOR 190</li>
  <li>define WEIGHTEDAVGTIPBLOCKS_UP 4</li>
  <li>define WEIGHTEDAVGTIPBLOCKS_DOWN 6</li>
</ol>

<p>const int64_t nTargetSpacing = 180; &lt;/code&gt;</p>

<p><strong>Timeline of the simulationː</strong></p>

<p><em><code class="highlighter-rouge">525000</code></em><code class="highlighter-rouge"> Hardfork mainet with ASIC on a special build and reduce the diff around 20 times, keep it at this level for 2305 blocks</code>
<em><code class="highlighter-rouge">527327</code></em><code class="highlighter-rouge"> ASIC is switched on and off to reduce the difficulty by spacing the blocks till GPU level is reached. Difficulty go from 50000 to around 10</code>
<em><code class="highlighter-rouge">530630</code></em><code class="highlighter-rouge"> At this block the difficulty is 5.6 and GPU hashrate is increased 12 times</code>
<em><code class="highlighter-rouge">531200</code></em><code class="highlighter-rouge"> At this block the difficulty is 48.6 and GPU hashrate is decreased 12 times</code>
<em><code class="highlighter-rouge">531800</code></em><code class="highlighter-rouge"> At this block the difficulty is 14.8 and GPU hashrate is increased 12 times</code>
<em><code class="highlighter-rouge">532280</code></em><code class="highlighter-rouge"> At this block the difficulty is 68 and GPU hashrate is decreased 12 times</code></p>

<h3 id="block-525000---527307-asic-difficulty-drop-25-times-at-350-mhs-scrypt">Block 525000 -&gt; 527307 ASIC difficulty drop 25 times at 350 MH/s scrypt</h3>

<p><strong>Difficulty plot</strong> from 1000000 to around 50000. The current difficulty is in green, the red average is the average used to cap the difficulty UP, the blue one is the average to cap the difficulty DOWN.</p>

<p><img src="/img/Difflim_ASICdrop.png" alt="Img" /></p>

<h3 id="block-527327---532465">Block 527327 -&gt; 532465</h3>

<p>The <strong>PIDOut</strong> is the result of all three PID calculations ie the Proportional̟-Integral-Derivative terms summed</p>

<p><code class="highlighter-rouge">dPidOutputTime = dProportionalTerm + dIntegratorTerm + dDerivativeTerm</code>
<img src="/img/Pidout.png" alt="Img" /></p>

<p>The proportional gain value is one of the most important setting to get right, too little and the PID is not reactive enough, too high and it becomes wild in retargetting.</p>

<p><code class="highlighter-rouge">dProportionalTerm = dProportionalGain * dSpacingError</code></p>

<p>The value was set to <code class="highlighter-rouge">PID_PROPORTIONALGAIN </code>“<code class="highlighter-rouge">1.7</code>” for this particular nTargetSpacing of 180 sec (<code class="highlighter-rouge">const int64_t nTargetSpacing = 180</code>) and tipfilter of 21 (<code class="highlighter-rouge">TIPFILTERBLOCKS_DEFAULT </code>“<code class="highlighter-rouge">21</code>”).</p>

<p>Those three values are linked so changing the tipfilter or nTargetspacing will influence the proportional gain.</p>

<p>The derivative Term is defined by <code class="highlighter-rouge">dDerivativeTerm = dDerivativeGain * dRateOfChange</code></p>

<p>in this particular PID setting, the Derivative term is set to <code class="highlighter-rouge">PID_DERIVATIVEGAIN </code>“<code class="highlighter-rouge">0</code>” so in fact anoncoin use a PI controller.</p>

<p>The PID integral term is calculated on the deviation from the <code class="highlighter-rouge">nTargetSpacing = 180</code>, the difference is multiplied by the integrator gain.</p>

<p><code class="highlighter-rouge">dIntegratorTerm = (dIntegratorBlockTime - (double)nTargetSpacing) * dIntegratorGain + (double)nTargetSpacing;</code></p>

<p>The integrator period is set to <code class="highlighter-rouge">PID_INTEGRATORTIME </code>“<code class="highlighter-rouge">172800</code>” so 48 h or 960 blocks.</p>

<p>The integral gain <code class="highlighter-rouge">PID_INTEGRATORGAIN </code>“<code class="highlighter-rouge">5</code>” is necessary to have the value settle quickly to the nTargetSpacing setpoint. The anti integral windup values <code class="highlighter-rouge">DMININTEGRATOR 170</code> and <code class="highlighter-rouge">DMAXINTEGRATOR 190</code> cap the integral term in case of huge change of block spacing (such as when lowering the diff so much as 5000 times like we just did). The differences between <code class="highlighter-rouge">DMININTEGRATOR 170</code> and <code class="highlighter-rouge">nTargetSpacing = 180</code> is multiplied by <code class="highlighter-rouge">dIntegratorGain 5</code> and so the minimum integral term is</p>

<p><code class="highlighter-rouge">(170-180)*5 + 180 = -50 + 180 = 130</code></p>

<p>Similarly the maximum integral gain is</p>

<p><code class="highlighter-rouge">(190-180)*5 + 180 = 230</code></p>

<p>The oscillation of the <strong>integral term</strong> due to the impact of the drop of hashrate of 5000 times are clearly seen in the following figure.
<img src="/img/Pid_intterm.png" alt="Img" /></p>

<p>The <strong>Tipsavg</strong> is the median time of successive 21 blocks (<code class="highlighter-rouge">TIPFILTERBLOCKS_DEFAULT </code>“<code class="highlighter-rouge">21</code>”). It does not deviate too much of 180 sec per block even with those huge change in hashrate and the variation of individual blocks space.
<img src="/img/Pid_tipsavg.png" alt="Img" /></p>

<p>The <strong>Space</strong> for individual blocks with moving average. Despite some blocks being very slow (due to drop in hashrate or variation in difficulty), the average is hovering around the <code class="highlighter-rouge">nTargetSpacing</code> of 180 sec.
<img src="/img/Pid_space.png" alt="Img" /></p>

<p>A zoom on the <strong>Space</strong> averages. You can see than thanks to the integral term there are waves like fluctuation around the median time to recover from the slow blocks due to the drop of difficulty and variations due to the integral term feedback loop period of 48 hours. Compare with the integral term graphicː when integral term is the most elevated the block space is quickest and vice versa.
<img src="/img/Pid_spacezoom.png" alt="Img" /></p>

<p><strong>Block time</strong> is an easy way to see the linearity of the block spacing by plotting the time stamp for each block vs the block number. It shall be a straight line with a slope of <code class="highlighter-rouge">nTargetSpacing 180</code> if there was constant hashrate or perfect control.
<img src="/img/Pid_blocktime.png" alt="Img" /></p>

<p><strong>Average blocktime</strong> is another easy way to check the total block spacing by doing an average of each block spacing from begining to a certain point and plotting the result. The curve shall settle to 180 sec over time. It is the same thing than the integrator do but the integrator has a moving windows of 48 h while this curve average all the block space since the begining of the experiment.
<img src="/img/Pid_avg_blocktime.png" alt="Img" /></p>

<p>This <strong>Logarithmic scale of difficulty</strong> per block show the overall change of difficulty since the initial drop of 50000 from ASIC level to a GPU level of 10, followed by the two GPU attacks at 12 times the hashrate.
<img src="/img/Pid_difficulty_log.png" alt="Img" /></p>

<p>Finally the <strong>Difficulty plot</strong> for each block are given below. The current difficulty is in green, the red average is the average used to cap the difficulty UP, the blue one is the average to cap the difficulty DOWN.</p>

<p>First periodː dropping the diff 5000 times from ASIC (block 1 is 527327) to GPU level. Blocks 1-1050 are shown.
<img src="/img/Difflim1-1050.png" alt="Img" /></p>

<p>The same period in logarithmic scale. Blocks 1-1050 are shown.
<img src="/img/Difflim1-1050log.png" alt="Img" /></p>

<p>A constant hashrate period at low GPU level. There is some instability in the difficulty because it is still recovering from the huge drop in hashrate (integral term is still fluctuating widely). Blocks 1050-2100 are shown.
<img src="/img/Difflim1050-2100.png" alt="Img" /></p>

<p>A constant hashrate period at low GPU level. The difficulty has stabilized now. You can see in no point the current difficulty in green touch the UP limit in red. The control is fully the PID and sometimes the limit average DOWN. Blocks 2100-3150 are shown. 
<img src="/img/Difflim2100-3150.png" alt="Img" /></p>

<p>In the following period an attack of x12 times the hashrate was done. The limit average UP in red was quickly touched during the increase in hahsrate, limiting the difficulty the proportional gain of the PID was requesting. After the block slowed down the difficulty reached a plateau and the average UP was no more touched. On stopping the attack, the slow blocks diminished the difficulty which was first allowed to diminish twice to 0.588 (100/170, <code class="highlighter-rouge">NMAXDIFFDECREASE </code>“<code class="highlighter-rouge">170</code>”), then was allowed to even go lower than the limit average DOWN for a quicker difficulty decrease. Around block 750 the quick block made the difficulty go up toward the limit average DOWN. Blocks 3150-4200 are shown. <img src="/img/Difflim3150-4200.png" alt="Img" /></p>

<p>In this last period an attack of x12 times the hashrate was done. The attack was very powerful because there was a stream of lucky block that shoot the difficulty higher than needed, even with the limit average UP reached for several blocks. This show the necessity of the average because if there was none the difficulty would have shoot up even more up. For coins that are not as attacked by multipool as anoncoin the current settings of <code class="highlighter-rouge">PID_PROPORTIONALGAIN </code>“<code class="highlighter-rouge">1.7</code>” can be lowered or <code class="highlighter-rouge">NMAXDIFFINCREASE </code>“<code class="highlighter-rouge">200</code>” (the limit average UP) can be lowered or <code class="highlighter-rouge">WEIGHTEDAVGTIPBLOCKS_UP 4</code> (the number of blocks averaged for calculating the limit average UP) can be increased. By changing one of those three value (especially the limit average settings) something less responsive can be obtained to avoid overdrive of difficuly in case of such attack coiciding with lucky blocks.
<img src="/img/Difflim4200-5250.png" alt="Img" /></p>

<p>If you have any question on the PID tuning feel free to mail cryptoslave@anoncoin.net</p>

    <p class="spacer"></p>
    </div>
</div>
</div>
</section>
<!-- Footer -->
<footer class="text-center">
    <div class="footer-above">
        <div class="container">
            <div class="row">
                <div class="footer-col col-md-4">
                    <h3>Contact</h3>
                    <p>
                         info@anoncoin.net
                        <br> 
                    </p>
                </div>
                <div class="footer-col col-md-4">
                    <h3>Around the Web</h3>
                    <ul class="list-inline">
                        
                        <li>
                            <a href="https://twitter.com/anoncoinproject" class="btn-social btn-outline">
                                <i class="fa fa-fw fa-twitter"></i>
                            </a>
                        </li>
                        
                        <li>
                            <a href="https://www.facebook.com/Anoncoin/" class="btn-social btn-outline">
                                <i class="fa fa-fw fa-facebook"></i>
                            </a>
                        </li>
                        
                        <li>
                            <a href="https://www.reddit.com/r/Anoncoin/" class="btn-social btn-outline">
                                <i class="fa fa-fw fa-reddit"></i>
                            </a>
                        </li>
                        
                        <li>
                            <a href="https://www.youtube.com/channel/UCwKSmUNcoRrBwm-kdsl1n2w" class="btn-social btn-outline">
                                <i class="fa fa-fw fa-youtube"></i>
                            </a>
                        </li>
                        
                        <li>
                            <a href="https://github.com/Anoncoin/anoncoin" class="btn-social btn-outline">
                                <i class="fa fa-fw fa-github"></i>
                            </a>
                        </li>
                        
                    </ul>
                </div>
                <div class="footer-col col-md-4">
                    <h3>Chat with us</h3>
                    <p>
                            <a href="https://join.slack.com/t/anoncoin/shared_invite/enQtMjcxMzUxMjk5ODYwLTU0OTJhNmIxNzYyY2JiMzUxOGZhMjYzNmQ3YmViNWM1OWIxZGNlMGY0Zjg1NzdhMDAyZmRiYTFhNTM1OWZiYTU
                            " class="btn btn-lg btn-outline">
                                <i class="fa fa-slack"></i> Join our Slack
                            </a>
                    </p>
                </div>
            </div>
        </div>
    </div>
    <div class="footer-below">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    Copyright &copy; Anoncoin 2018
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- Scroll to Top Button (Only visible on small and extra-small screen sizes) -->
<div class="scroll-top page-scroll visible-xs visible-sm">
    <a class="btn btn-primary" href="#page-top">
        <i class="fa fa-chevron-up"></i>
    </a>
</div>

    <!-- jQuery Version 1.11.0 -->
<script src=" /js/jquery-1.11.0.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src=" /js/bootstrap.min.js "></script>

<!-- Plugin JavaScript -->
<script src=" /js/jquery.easing.min.js "></script>
<script src=" /js/classie.js "></script>
<script src=" /js/cbpAnimatedHeader.js "></script>

<!-- Custom Theme JavaScript -->
<script src=" /js/freelancer.js "></script> 
    </body>
</html>